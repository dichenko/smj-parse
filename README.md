# Smart-J Data Collector

.Скрипт для сбора данных о проведенных занятиях с сайта http://my.smart-j.ru/ и сохранения их в базу данных SQLite.

## Структура проекта

- `main.py` - Главный скрипт для запуска всех компонентов
- `src/` - Директория с исходным кодом
  - `database/` - Модули для работы с базой данных
    - `schema.py` - Создание структуры базы данных
    - `operations.py` - Операции с базой данных
  - `parsers/` - Модули для сбора данных
    - `auth.py` - Авторизация на сайте
    - `lesson_parser.py` - Парсинг данных о занятиях
  - `web/` - Веб-интерфейс
    - `app.py` - Flask приложение
  - `utils/` - Вспомогательные функции
    - `logger.py` - Настройка логирования
  - `config.py` - Конфигурационные параметры
- `requirements.txt` - Список зависимостей
- `setup.py` - Скрипт для установки пакета

## Установка

1. Установите Python 3.7 или выше
2. Установите зависимости:

```bash
pip install -r requirements.txt
```

## Использование

### Запуск всех компонентов сразу

```bash
python main.py --all
```

Эта команда последовательно выполнит создание базы данных, сбор данных и запуск веб-интерфейса.

### Запуск компонентов по отдельности

#### 1. Сбор данных

```bash
python main.py --collect
```

Эта команда создаст базу данных (если она не существует) и соберет данные с сайта.

#### 2. Запуск веб-интерфейса

```bash
python main.py --web
```

После запуска веб-интерфейса откройте браузер и перейдите по адресу http://127.0.0.1:8080/

## Функциональность

### Сбор данных

Модуль `src.parsers.lesson_parser`:
- Авторизуется на сайте http://my.smart-j.ru/
- Скачивает данные с трех страниц (Matata, Kids, JUnior)
- Извлекает темы занятий из заголовков строк таблицы
- Определяет города из заголовков столбцов таблицы
- Находит проведенные занятия по зеленым ячейкам с фоном #96fe96
- Извлекает информацию о преподавателе и дате из всплывающих окон (popover)
- Сохраняет данные в SQLite, избегая дублирования

### Веб-интерфейс

Веб-интерфейс (`src.web.app`) позволяет:
- Фильтровать занятия по модулю и городу
- Просматривать данные с пагинацией (10 занятий на странице)
- Сортировать занятия по дате (от новых к старым)

## Структура базы данных

База данных SQLite состоит из следующих таблиц:

- `modules` - Модули обучения (Matata, Kids, JUnior)
  - `id` - Уникальный идентификатор
  - `name` - Название модуля
  - `url` - URL страницы с данными модуля

- `cities` - Города
  - `id` - Уникальный идентификатор
  - `name` - Название города

- `topics` - Темы занятий
  - `id` - Уникальный идентификатор
  - `module_id` - Идентификатор модуля
  - `title` - Название темы

- `teachers` - Преподаватели
  - `id` - Уникальный идентификатор
  - `name` - Имя преподавателя

- `lessons` - Проведенные занятия
  - `id` - Уникальный идентификатор
  - `topic_id` - Идентификатор темы
  - `city_id` - Идентификатор города
  - `teacher_id` - Идентификатор преподавателя
  - `date` - Дата проведения занятия
  - `additional_info` - Дополнительная информация
  - `created_at` - Дата и время добавления записи в базу данных

## Логирование

Логи работы скрипта сохраняются в директорию `logs/`.
